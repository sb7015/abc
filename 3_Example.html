<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeMo Guardrails - Health Insurance Flow</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #f5f5f5 0%, #e8e8e8 100%);
            overflow-y: auto;
            overflow-x: hidden;
            height: auto;
            min-height: 100vh;
        }

        .presentation-container {
            width: 100vw;
            height: auto;
            min-height: 100vh;
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: linear-gradient(90deg, #2B1B49 0%, #5009B5 100%);
            color: white;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .header h1 {
            font-size: 28px;
            font-weight: bold;
        }

        .main-content {
            flex: 1;
            position: relative;
            padding: 20px;
            display: flex;
            flex-direction: column;
            min-height: calc(100vh - 120px);
        }

        .user-query {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            border: 3px solid #1976d2;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 6px 20px rgba(25, 118, 210, 0.2);
            opacity: 0;
            transform: translateY(-30px);
            transition: all 0.8s ease;
        }

        .user-query.show {
            opacity: 1;
            transform: translateY(0);
        }

        .user-query h3 {
            color: #1976d2;
            margin-bottom: 10px;
            font-size: 18px;
        }

        .user-query p {
            font-style: italic;
            line-height: 1.5;
            color: #333;
        }

        .architecture-container {
            flex: 1;
            position: relative;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 20px 0;
        }

        .layer {
            width: 18%;
            height: 200px;
            border-radius: 15px;
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            transition: all 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            opacity: 0.3;
            transform: scale(0.95);
            cursor: pointer;
        }

        .layer.active {
            opacity: 1;
            transform: scale(1.05);
            box-shadow: 0 12px 35px rgba(0,0,0,0.25);
        }

        .layer.completed {
            opacity: 0.8;
            transform: scale(1);
        }

        .input-rails {
            background: linear-gradient(135deg, #794CFF 0%, #5009B5 100%);
            color: white;
        }

        .dialog-rails {
            background: linear-gradient(135deg, #5009B5 0%, #2B1B49 100%);
            color: white;
        }

        .llm-layer {
            background: linear-gradient(135deg, #00B8B5 0%, #009F9D 100%);
            color: white;
        }

        .output-rails {
            background: linear-gradient(135deg, #FFE8E4 0%, #F5C5C0 100%);
            color: #231E35;
        }

        .final-output {
            background: linear-gradient(135deg, #e1f5fe 0%, #b3e5fc 100%);
            color: #0277bd;
        }

        .layer h3 {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .layer .timing {
            background: rgba(255,255,255,0.2);
            padding: 4px 8px;
            border-radius: 10px;
            font-size: 12px;
            margin-bottom: 10px;
        }

        .layer .status {
            font-size: 14px;
            font-weight: bold;
        }

        .arrow {
            width: 4%;
            height: 4px;
            background: #666;
            position: relative;
            margin: 0 1%;
            opacity: 0;
            transition: all 0.5s ease;
        }

        .arrow::after {
            content: '';
            position: absolute;
            right: -8px;
            top: -6px;
            width: 0;
            height: 0;
            border-left: 10px solid #666;
            border-top: 7px solid transparent;
            border-bottom: 7px solid transparent;
        }

        .arrow.show {
            opacity: 1;
        }

        .arrow.input-to-dialog {
            background: #5009B5;
        }
        .arrow.input-to-dialog::after {
            border-left-color: #5009B5;
        }

        .arrow.dialog-to-llm {
            background: #00B8B5;
        }
        .arrow.dialog-to-llm::after {
            border-left-color: #00B8B5;
        }

        .arrow.llm-to-output {
            background: #c2185b;
        }
        .arrow.llm-to-output::after {
            border-left-color: #c2185b;
        }

        .arrow.output-to-final {
            background: #0277bd;
        }
        .arrow.output-to-final::after {
            border-left-color: #0277bd;
        }

        .details-panel {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.1);
            min-height: 120px;
            transition: all 0.5s ease;
        }

        .details-content {
            display: none;
        }

        .details-content.active {
            display: block;
            animation: fadeInUp 0.5s ease;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .component-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .component {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
            border-left: 4px solid #28a745;
            transition: all 0.3s ease;
        }

        .component.warning {
            border-left-color: #ffc107;
        }

        .component.error {
            border-left-color: #dc3545;
        }

        .component h4 {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }

        .component p {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
        }

        .component .status-badge {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: bold;
        }

        .status-badge.pass {
            background: #d4edda;
            color: #155724;
        }

        .status-badge.warning {
            background: #fff3cd;
            color: #856404;
        }

        .status-badge.error {
            background: #f8d7da;
            color: #721c24;
        }

        .controls {
            display: none;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 25px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 100px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.2);
        }

        .btn-primary {
            background: linear-gradient(135deg, #5009B5 0%, #794CFF 100%);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #666 0%, #888 100%);
            color: white;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .progress-bar {
            position: fixed;
            top: 0;
            left: 0;
            height: 4px;
            background: linear-gradient(90deg, #5009B5 0%, #00B8B5 100%);
            transition: width 0.5s ease;
            z-index: 1000;
        }

        .rag-highlight {
            background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
            border: 2px solid #ff9800;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
        }

        .rag-highlight h4 {
            color: #e65100;
            margin-bottom: 10px;
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(80, 9, 181, 0.7);
            }
            70% {
                box-shadow: 0 0 0 20px rgba(80, 9, 181, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(80, 9, 181, 0);
            }
        }

        .fullscreen-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.9);
            border: none;
            border-radius: 8px;
            padding: 10px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .progress-slider {
            position: fixed;
            left: 30px;
            top: 50%;
            transform: translateY(-50%);
            width: 40px;
            height: 300px;
            background: rgba(255,255,255,0.9);
            border-radius: 20px;
            padding: 10px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            backdrop-filter: blur(10px);
            display: none;
        }

        .slider-track {
            width: 6px;
            height: 250px;
            background: #e0e0e0;
            border-radius: 3px;
            position: relative;
            margin: 10px 0;
        }

        .slider-progress {
            width: 100%;
            background: linear-gradient(180deg, #5009B5 0%, #00B8B5 100%);
            border-radius: 3px;
            transition: height 0.5s ease;
            position: absolute;
            bottom: 0;
        }

        .slider-handle {
            width: 16px;
            height: 16px;
            background: #5009B5;
            border-radius: 50%;
            position: absolute;
            left: -5px;
            transition: bottom 0.5s ease;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .slider-handle:hover {
            transform: scale(1.2);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .slider-labels {
            position: absolute;
            right: -80px;
            top: 0;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            font-size: 10px;
            color: #666;
            padding: 10px 0;
        }

        .slider-label {
            writing-mode: vertical-lr;
            text-orientation: mixed;
            font-weight: bold;
            cursor: pointer;
            padding: 2px;
            border-radius: 3px;
            transition: all 0.3s ease;
        }

        .slider-label:hover {
            background: rgba(80, 9, 181, 0.1);
            color: #5009B5;
        }

        .slider-label.active {
            background: #5009B5;
            color: white;
        }
    </style>
</head>
<body>
    <div class="progress-slider" style="display: none;">
        <div class="slider-track">
            <div class="slider-progress" id="sliderProgress"></div>
            <div class="slider-handle" id="sliderHandle"></div>
        </div>
    </div>
    
    <button class="fullscreen-btn" onclick="toggleFullscreen()" title="Toggle Fullscreen">üî≤</button>
    
    <div class="progress-bar" id="progressBar"></div>
    
    <div class="presentation-container">
        <div class="header">
            <h1>NeMo Guardrails Architecture</h1>
        </div>

        <div class="main-content">
            <div class="user-query" id="userQuery">
                <h3>üë§ Customer Query:</h3>
                <p>"I was diagnosed with Type 2 diabetes last month and my doctor prescribed Ozempic. My policy number is HLTH-2024-56789. Is this covered under my plan? I'm really worried about the cost since I heard it's expensive. Can you tell me exactly how much I'll have to pay out of pocket?"</p>
            </div>

            <div class="architecture-container">
                <div class="layer input-rails" id="inputRails">
                    <h3>üîç Input Rails</h3>
                    <div class="status">Security & Validation</div>
                </div>

                <div class="arrow input-to-dialog" id="arrow1"></div>

                <div class="layer dialog-rails" id="dialogRails">
                    <h3>üéØ Dialog Rails</h3>
                    <div class="status">Intent & Routing</div>
                </div>

                <div class="arrow dialog-to-llm" id="arrow2"></div>

                <div class="layer llm-layer" id="llmLayer">
                    <h3>ü§ñ LLM Layer</h3>
                    <div class="status">Processing & RAG</div>
                </div>

                <div class="arrow llm-to-output" id="arrow3"></div>

                <div class="layer output-rails" id="outputRails">
                    <h3>üìã Output Rails</h3>
                    <div class="status">Validation & Compliance</div>
                </div>

                <div class="arrow output-to-final" id="arrow4"></div>

                <div class="layer final-output" id="finalOutput">
                    <h3>‚úÖ Final Output</h3>
                    <div class="status">Safe Response</div>
                </div>
            </div>

            <div class="details-panel">
                <div class="details-content" id="welcomeDetails">
                    <h2>üéØ Interactive NeMo Guardrails Demo</h2>
                    <p>This presentation shows how a health insurance query flows through each layer of the NeMo Guardrails architecture.</p>
                    <p><strong>Click "Next Step" to begin the journey, or click on any layer to jump to that stage.</strong></p>
                    <ul style="margin-top: 15px; padding-left: 20px;">
                        <li><strong>Real Example:</strong> Ozempic coverage inquiry with policy lookup</li>
                        <li><strong>Interactive:</strong> Click through each processing stage</li>
                        <li><strong>Technical Details:</strong> See exactly what happens at each layer</li>
                        <li><strong>RAG Integration:</strong> Watch knowledge base retrieval in action</li>
                    </ul>
                </div>

                <div class="details-content" id="inputDetails">
                    <h2>üîç Input Rails Processing</h2>
                    <p>First line of defense - validates and secures incoming requests</p>
                    <div class="component-grid">
                        <div class="component">
                            <h4>Jailbreak Detection</h4>
                            <p>Scans for malicious prompt patterns</p>
                            <span class="status-badge pass">‚úÖ PASS</span>
                        </div>
                        <div class="component">
                            <h4>Topic Classification</h4>
                            <p>Identified: "health insurance coverage"</p>
                            <span class="status-badge pass">‚úÖ PASS</span>
                        </div>
                        <div class="component">
                            <h4>User Verification</h4>
                            <p>Policy format HLTH-2024-56789 validated</p>
                            <span class="status-badge pass">‚úÖ PASS</span>
                        </div>
                        <div class="component warning">
                            <h4>PII Detection</h4>
                            <p>Flagged: Policy number + medical condition</p>
                            <span class="status-badge warning">‚ö†Ô∏è PHI DETECTED</span>
                        </div>
                        <div class="component">
                            <h4>Content Moderation</h4>
                            <p>Appropriate healthcare inquiry language</p>
                            <span class="status-badge pass">‚úÖ PASS</span>
                        </div>
                        <div class="component">
                            <h4>Smart Caching</h4>
                            <p>No cached response found</p>
                            <span class="status-badge pass">‚úÖ PASS</span>
                        </div>
                    </div>
                    <p style="margin-top: 15px;"><strong>üü¢ Result:</strong> Request approved for Dialog Rails processing</p>
                </div>

                <div class="details-content" id="dialogDetails">
                    <h2>üéØ Dialog Rails Processing</h2>
                    <p>Intent recognition and workflow routing using Colang scripts</p>
                    <div class="component-grid">
                        <div class="component">
                            <h4>Intent Recognition</h4>
                            <p>Classified: "prescription_coverage_inquiry"</p>
                            <span class="status-badge pass">‚úÖ DETECTED</span>
                        </div>
                        <div class="component">
                            <h4>Flow Management</h4>
                            <p>Routing to pharmacy benefits workflow</p>
                            <span class="status-badge pass">‚úÖ ROUTED</span>
                        </div>
                        <div class="component">
                            <h4>Context Tracking</h4>
                            <p>Stored: Policy ID, medication, condition</p>
                            <span class="status-badge pass">‚úÖ TRACKED</span>
                        </div>
                        <div class="component">
                            <h4>Conditional Routing</h4>
                            <p>Requires: Formulary lookup + prior auth check</p>
                            <span class="status-badge pass">‚úÖ PLANNED</span>
                        </div>
                        <div class="component">
                            <h4>Error Handling</h4>
                            <p>Circuit breakers: All systems operational</p>
                            <span class="status-badge pass">‚úÖ STABLE</span>
                        </div>
                        <div class="component">
                            <h4>HIPAA Compliance</h4>
                            <p>PHI handling protocols activated</p>
                            <span class="status-badge pass">‚úÖ COMPLIANT</span>
                        </div>
                    </div>
                    <p style="margin-top: 15px;"><strong>üü¢ Result:</strong> Query prepared for LLM processing with full context</p>
                </div>

                <div class="details-content" id="llmDetails">
                    <h2>ü§ñ LLM Layer Processing</h2>
                    <p>Main processing with RAG-enhanced knowledge retrieval</p>
                    
                    <div class="rag-highlight">
                        <h4>üìö RAG System Active</h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 10px;">
                            <div>
                                <strong>Vector DB Search:</strong><br>
                                ‚úÖ Formulary database: "Ozempic" (semaglutide)<br>
                                ‚úÖ Drug classification: GLP-1 agonist, Tier 3
                            </div>
                            <div>
                                <strong>Policy Document Retrieval:</strong><br>
                                ‚úÖ Member benefits: HLTH-2024-56789<br>
                                ‚úÖ Coverage rules: Prior authorization required
                            </div>
                        </div>
                    </div>

                    <div class="component-grid">
                        <div class="component">
                            <h4>Main LLM (GPT-4)</h4>
                            <p>Processing query with RAG context</p>
                            <span class="status-badge pass">‚úÖ PROCESSING</span>
                        </div>
                        <div class="component">
                            <h4>Guardrail LLM</h4>
                            <p>Validating medical accuracy & compliance</p>
                            <span class="status-badge pass">‚úÖ VALIDATED</span>
                        </div>
                        <div class="component">
                            <h4>Knowledge Base</h4>
                            <p>Cross-checking formulary & policy rules</p>
                            <span class="status-badge pass">‚úÖ VERIFIED</span>
                        </div>
                        <div class="component">
                            <h4>Parallel Processing</h4>
                            <p>Simultaneous policy + drug lookups</p>
                            <span class="status-badge pass">‚úÖ OPTIMIZED</span>
                        </div>
                        <div class="component">
                            <h4>Medical Compliance</h4>
                            <p>No medical advice given, only coverage info</p>
                            <span class="status-badge pass">‚úÖ COMPLIANT</span>
                        </div>
                        <div class="component">
                            <h4>Cost Calculation</h4>
                            <p>Estimated copay: $75/month (with prior auth)</p>
                            <span class="status-badge pass">‚úÖ CALCULATED</span>
                        </div>
                    </div>
                    <p style="margin-top: 15px;"><strong>üü¢ Result:</strong> Comprehensive response generated with accurate coverage details</p>
                </div>

                <div class="details-content" id="outputDetails">
                    <h2>üìã Output Rails Processing</h2>
                    <p>Final validation and compliance checks before response delivery</p>
                    <div class="component-grid">
                        <div class="component">
                            <h4>Fact Checking</h4>
                            <p>Drug information validated against medical database</p>
                            <span class="status-badge pass">‚úÖ ACCURATE</span>
                        </div>
                        <div class="component">
                            <h4>Content Filtering</h4>
                            <p>No inappropriate medical advice detected</p>
                            <span class="status-badge pass">‚úÖ SAFE</span>
                        </div>
                        <div class="component">
                            <h4>PII Protection</h4>
                            <p>No additional member PHI leaked in response</p>
                            <span class="status-badge pass">‚úÖ PROTECTED</span>
                        </div>
                        <div class="component">
                            <h4>Format Validation</h4>
                            <p>Healthcare communication standards met</p>
                            <span class="status-badge pass">‚úÖ FORMATTED</span>
                        </div>
                        <div class="component">
                            <h4>HIPAA Audit</h4>
                            <p>Interaction logged for compliance tracking</p>
                            <span class="status-badge pass">‚úÖ LOGGED</span>
                        </div>
                        <div class="component">
                            <h4>Legal Disclaimers</h4>
                            <p>Appropriate cost and coverage warnings included</p>
                            <span class="status-badge pass">‚úÖ INCLUDED</span>
                        </div>
                    </div>
                    <p style="margin-top: 15px;"><strong>üü¢ Result:</strong> Response cleared for delivery - fully compliant and safe</p>
                </div>

                <div class="details-content" id="finalDetails">
                    <h2>‚úÖ Final Output Delivered</h2>
                    <div style="background: #e8f5e9; border-radius: 10px; padding: 20px; border-left: 5px solid #4caf50;">
                        <h3 style="color: #2e7d32; margin-bottom: 15px;">Customer Response:</h3>
                        <p style="font-style: italic; line-height: 1.6; color: #333;">
                            "I can help you understand your Ozempic coverage. Based on your policy HLTH-2024-56789, Ozempic is a Tier 3 specialty medication that requires prior authorization. Here's what you need to know:<br><br>
                            
                            <strong>1. Coverage:</strong> Your plan does cover Ozempic for Type 2 diabetes<br>
                            <strong>2. Prior Authorization:</strong> Your doctor must submit medical documentation showing medical necessity<br>
                            <strong>3. Step Therapy:</strong> You may need to try metformin or other first-line treatments first<br>
                            <strong>4. Estimated Costs:</strong> With prior auth approval, your copay would be $75/month<br><br>
                            
                            Next steps: Have your doctor submit a prior authorization request. This typically takes 3-5 business days. I've created case reference: CASE-2024-34567 for tracking."
                        </p>
                    </div>
                    
                    <div style="margin-top: 20px; display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                            <h4 style="color: #495057; margin-bottom: 10px;">üîê Security Achievements</h4>
                            <ul style="padding-left: 20px; color: #666;">
                                <li>PHI properly protected throughout</li>
                                <li>No medical advice given</li>
                                <li>HIPAA compliance maintained</li>
                                <li>Full audit trail created</li>
                            </ul>
                        </div>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 8px;">
                            <h4 style="color: #495057; margin-bottom: 10px;">‚ö° Performance Metrics</h4>
                            <ul style="padding-left: 20px; color: #666;">
                                <li>Total processing: 6.2 seconds</li>
                                <li>RAG queries: 4 database lookups</li>
                                <li>Accuracy: 100% policy compliance</li>
                                <li>Customer satisfaction: High value response</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="controls" style="display: none;">
        <button class="btn btn-secondary" id="prevBtn" onclick="previousStep()">Previous</button>
        <button class="btn btn-primary" id="nextBtn" onclick="nextStep()">Next Step</button>
        <button class="btn btn-secondary" onclick="resetPresentation()">Reset</button>
    </div>

    <script>
        let currentStep = 0;
        const totalSteps = 6;
        const layers = ['inputRails', 'dialogRails', 'llmLayer', 'outputRails', 'finalOutput'];
        const arrows = ['arrow1', 'arrow2', 'arrow3', 'arrow4'];
        const details = ['welcomeDetails', 'inputDetails', 'dialogDetails', 'llmDetails', 'outputDetails', 'finalDetails'];

        function updateProgress() {
            const progressBar = document.getElementById('progressBar');
            const sliderProgress = document.getElementById('sliderProgress');
            const sliderHandle = document.getElementById('sliderHandle');
            const progress = (currentStep / totalSteps) * 100;
            
            progressBar.style.width = progress + '%';
            sliderProgress.style.height = progress + '%';
            sliderHandle.style.bottom = (progress * 2.5) + 'px'; // 250px track height
            
            // Update slider labels
            document.querySelectorAll('.slider-label').forEach((label, index) => {
                label.classList.toggle('active', index === currentStep);
            });
        }

        function showStep(step) {
            // Hide all details
            details.forEach(detail => {
                document.getElementById(detail).classList.remove('active');
            });

            // Reset all layers
            layers.forEach(layer => {
                const element = document.getElementById(layer);
                element.classList.remove('active', 'completed', 'pulse');
            });

            // Hide all arrows
            arrows.forEach(arrow => {
                document.getElementById(arrow).classList.remove('show');
            });

            // Show user query if step > 0
            if (step > 0) {
                document.getElementById('userQuery').classList.add('show');
            }

            // Update based on current step
            if (step === 0) {
                document.getElementById('welcomeDetails').classList.add('active');
            } else if (step <= layers.length) {
                // Show completed layers
                for (let i = 0; i < step - 1; i++) {
                    document.getElementById(layers[i]).classList.add('completed');
                    if (i < arrows.length) {
                        document.getElementById(arrows[i]).classList.add('show');
                    }
                }

                // Show active layer
                if (step <= layers.length) {
                    document.getElementById(layers[step - 1]).classList.add('active', 'pulse');
                    document.getElementById(details[step]).classList.add('active');
                }
            } else {
                // Final step - show all completed
                layers.forEach(layer => {
                    document.getElementById(layer).classList.add('completed');
                });
                arrows.forEach(arrow => {
                    document.getElementById(arrow).classList.add('show');
                });
                document.getElementById('finalDetails').classList.add('active');
            }

            updateProgress();
            updateButtons();
        }

        function updateButtons() {
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');

            prevBtn.disabled = currentStep === 0;
            nextBtn.disabled = currentStep >= totalSteps - 1;

            if (currentStep >= totalSteps - 1) {
                nextBtn.textContent = 'Complete';
            } else {
                nextBtn.textContent = 'Next Step';
            }
        }

        function nextStep() {
            if (currentStep < totalSteps - 1) {
                currentStep++;
                showStep(currentStep);
            }
        }

        function previousStep() {
            if (currentStep > 0) {
                currentStep--;
                showStep(currentStep);
            }
        }

        function resetPresentation() {
            currentStep = 0;
            document.getElementById('userQuery').classList.remove('show');
            showStep(currentStep);
        }

        function jumpToStep(step) {
            currentStep = step;
            showStep(currentStep);
        }

        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(err => {
                    console.log('Error attempting to enable fullscreen:', err);
                });
            } else {
                document.exitFullscreen();
            }
        }

        // Add click handlers for layers
        layers.forEach((layerId, index) => {
            document.getElementById(layerId).addEventListener('click', () => {
                jumpToStep(index + 1);
            });
        });

        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            switch(e.key) {
                case 'ArrowRight':
                case ' ':
                    e.preventDefault();
                    nextStep();
                    break;
                case 'ArrowLeft':
                    e.preventDefault();
                    previousStep();
                    break;
                case 'Home':
                    e.preventDefault();
                    resetPresentation();
                    break;
                case 'F11':
                    e.preventDefault();
                    toggleFullscreen();
                    break;
                case 'Escape':
                    if (document.fullscreenElement) {
                        document.exitFullscreen();
                    }
                    break;
            }
        });

        // Auto-advance option (uncomment to enable)
        // let autoAdvance = false;
        // function startAutoAdvance() {
        //     if (autoAdvance) return;
        //     autoAdvance = true;
        //     const interval = setInterval(() => {
        //         if (currentStep < totalSteps - 1) {
        //             nextStep();
        //         } else {
        //             clearInterval(interval);
        //             autoAdvance = false;
        //         }
        //     }, 4000); // 4 seconds per step
        // }

        // Initialize with all steps visible for scrollable view
        function initializeScrollView() {
            // Show user query
            document.getElementById('userQuery').classList.add('show');
            
            // Show all layers as completed
            layers.forEach(layer => {
                document.getElementById(layer).classList.add('completed');
            });
            
            // Show all arrows
            arrows.forEach(arrow => {
                document.getElementById(arrow).classList.add('show');
            });
            
            // Show all details sections
            details.forEach(detail => {
                document.getElementById(detail).classList.add('active');
            });
            
            updateProgress();
        }

        // Initialize the scrollable view
        initializeScrollView();

        // Add hover effects for layers
        layers.forEach(layerId => {
            const layer = document.getElementById(layerId);
            layer.addEventListener('mouseenter', () => {
                if (!layer.classList.contains('active')) {
                    layer.style.transform = 'scale(1.02)';
                    layer.style.opacity = '0.9';
                }
            });
            layer.addEventListener('mouseleave', () => {
                if (!layer.classList.contains('active')) {
                    layer.style.transform = layer.classList.contains('completed') ? 'scale(1)' : 'scale(0.95)';
                    layer.style.opacity = layer.classList.contains('completed') ? '0.8' : '0.3';
                }
            });
        });

        // Add smooth scrolling for mobile
        if (window.innerWidth <= 768) {
            document.body.style.overflow = 'auto';
            document.querySelector('.presentation-container').style.height = 'auto';
            document.querySelector('.presentation-container').style.minHeight = '100vh';
        }

        // Performance optimization: Preload next step animations
        function preloadAnimations() {
            const style = document.createElement('style');
            style.textContent = `
                .layer { will-change: transform, opacity; }
                .arrow { will-change: opacity; }
                .details-content { will-change: opacity, transform; }
            `;
            document.head.appendChild(style);
        }

        // Add drag functionality to slider handle
        let isDragging = false;
        const sliderHandle = document.getElementById('sliderHandle');
        const sliderTrack = document.querySelector('.slider-track');

        sliderHandle.addEventListener('mousedown', (e) => {
            isDragging = true;
            e.preventDefault();
        });

        document.addEventListener('mousemove', (e) => {
            if (!isDragging) return;
            
            const trackRect = sliderTrack.getBoundingClientRect();
            const relativeY = e.clientY - trackRect.top;
            const percentage = Math.max(0, Math.min(100, ((trackRect.height - relativeY) / trackRect.height) * 100));
            const step = Math.round((percentage / 100) * totalSteps);
            
            if (step !== currentStep && step >= 0 && step < totalSteps) {
                jumpToStep(step);
            }
        });

        document.addEventListener('mouseup', () => {
            isDragging = false;
        });

        // Add click-to-jump on slider track
        sliderTrack.addEventListener('click', (e) => {
            if (e.target === sliderHandle) return;
            
            const trackRect = sliderTrack.getBoundingClientRect();
            const relativeY = e.clientY - trackRect.top;
            const percentage = Math.max(0, Math.min(100, ((trackRect.height - relativeY) / trackRect.height) * 100));
            const step = Math.round((percentage / 100) * totalSteps);
            
            if (step >= 0 && step < totalSteps) {
                jumpToStep(step);
            }
        });

        preloadAnimations();

        // Add presentation timer
        let startTime = Date.now();
        let timerInterval;

        function startTimer() {
            timerInterval = setInterval(() => {
                const elapsed = Math.floor((Date.now() - startTime) / 1000);
                const minutes = Math.floor(elapsed / 60);
                const seconds = elapsed % 60;
                // Uncomment to show timer in console
                // console.log(`Presentation time: ${minutes}:${seconds.toString().padStart(2, '0')}`);
            }, 1000);
        }

        function stopTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                const totalTime = Math.floor((Date.now() - startTime) / 1000);
                console.log(`Total presentation time: ${totalTime} seconds`);
            }
        }

        // Start timer when first step is taken
        document.getElementById('nextBtn').addEventListener('click', () => {
            if (currentStep === 1 && !timerInterval) {
                startTimer();
            }
        });

        // Analytics tracking (optional)
        function trackStep(step) {
            // Uncomment to track presentation analytics
            // console.log(`Step ${step} viewed at ${new Date().toISOString()}`);
            // You can integrate with Google Analytics or other tracking here
        }

        // Update showStep to include tracking
        const originalShowStep = showStep;
        showStep = function(step) {
            originalShowStep(step);
            trackStep(step);
        };

        // Add print styles for PDF export
        const printStyles = `
            @media print {
                .controls, .fullscreen-btn, .progress-bar, .progress-slider { display: none !important; }
                .presentation-container { height: auto !important; }
                .main-content { padding: 0 !important; }
                .layer { opacity: 1 !important; transform: none !important; }
                .details-content { display: block !important; page-break-after: always; }
                body { overflow: visible !important; }
            }
        `;
        
        const printStyleSheet = document.createElement('style');
        printStyleSheet.textContent = printStyles;
        document.head.appendChild(printStyleSheet);
    </script>
</body>
</html>

        // Add presentation timer
        let startTime = Date.now();
        let timerInterval;

        function startTimer() {
            timerInterval = setInterval(() => {
                const elapsed = Math.floor((Date.now() - startTime) / 1000);
                const minutes = Math.floor(elapsed / 60);
                const seconds = elapsed % 60;
                // Uncomment to show timer in console
                // console.log(`Presentation time: ${minutes}:${seconds.toString().padStart(2, '0')}`);
            }, 1000);
        }

        function stopTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                const totalTime = Math.floor((Date.now() - startTime) / 1000);
                console.log(`Total presentation time: ${totalTime} seconds`);
            }
        }

        // Start timer when first step is taken
        document.getElementById('nextBtn').addEventListener('click', () => {
            if (currentStep === 1 && !timerInterval) {
                startTimer();
            }
        });

        // Analytics tracking (optional)
        function trackStep(step) {
            // Uncomment to track presentation analytics
            // console.log(`Step ${step} viewed at ${new Date().toISOString()}`);
            // You can integrate with Google Analytics or other tracking here
        }

        // Update showStep to include tracking
        const originalShowStep = showStep;
        showStep = function(step) {
            originalShowStep(step);
            trackStep(step);
        };

        // Add print styles for PDF export
        const printStyles = `
            @media print {
                .controls, .fullscreen-btn, .progress-bar { display: none !important; }
                .presentation-container { height: auto !important; }
                .main-content { padding: 0 !important; }
                .layer { opacity: 1 !important; transform: none !important; }
                .details-content { display: block !important; page-break-after: always; }
                body { overflow: visible !important; }
            }
        `;
        
        const printStyleSheet = document.createElement('style');
        printStyleSheet.textContent = printStyles;
        document.head.appendChild(printStyleSheet);
    </script>
</body>
</html>